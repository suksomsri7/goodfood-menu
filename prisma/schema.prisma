generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== หมวดอาหาร ====================
model Category {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  color       String   @default("#4CAF50")
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  foods       Food[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("categories")
}

// ==================== เมนูอาหาร ====================
model Food {
  id            String   @id @default(cuid())
  name          String
  description   String?
  ingredients   String[] @default([]) // ส่วนประกอบ
  imageUrl      String?
  images        String[] @default([]) // รูปภาพหลายรูป
  price         Float
  discountPrice Float?   // ราคาลด
  badge         String?  // "discount" | "popular" | "bestseller"
  calories      Float    // เปลี่ยนเป็น Float เพื่อรองรับทศนิยม
  protein       Float
  carbs         Float
  fat           Float
  fiber         Float?
  sugar         Float?
  sodium        Float?
  servingSize   Float?
  servingUnit   String?
  warning       String?  // คำเตือน เช่น แพ้อาหาร
  isActive      Boolean  @default(true)
  order         Int      @default(0)
  categoryId    String
  category      Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  promotionItems PromotionItem[]
  promotionGifts PromotionGift[]

  @@map("foods")
}

// ==================== แพ็คเกจอาหาร ====================
model Package {
  id            String   @id @default(cuid())
  name          String
  description   String?
  imageUrl      String?
  requiredItems Int      @default(1) // จำนวนรายการที่ต้องซื้อเพื่อรับส่วนลด
  discountType  String   @default("percent") // "percent" | "fixed"
  discountValue Float    @default(0) // ค่าส่วนลด (เป็น % หรือ จำนวนเงิน)
  isActive      Boolean  @default(true)
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("packages")
}

// ==================== โปรโมชั่น ====================
model Promotion {
  id          String          @id @default(cuid())
  name        String
  description String?
  imageUrl    String?
  type        String          // "discount" | "bundle" | "gift"
  discountType String?        // "percent" | "fixed"
  discountValue Float?
  startDate   DateTime?
  endDate     DateTime?
  isActive    Boolean         @default(true)
  items       PromotionItem[]
  gifts       PromotionGift[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("promotions")
}

model PromotionItem {
  id          String    @id @default(cuid())
  promotionId String
  promotion   Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  foodId      String
  food        Food      @relation(fields: [foodId], references: [id], onDelete: Cascade)
  quantity    Int       @default(1)

  @@unique([promotionId, foodId])
  @@map("promotion_items")
}

model PromotionGift {
  id          String    @id @default(cuid())
  promotionId String
  promotion   Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  foodId      String
  food        Food      @relation(fields: [foodId], references: [id], onDelete: Cascade)
  quantity    Int       @default(1)

  @@unique([promotionId, foodId])
  @@map("promotion_gifts")
}

// ==================== บทความ ====================
model Article {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  excerpt   String?
  content   String?  @db.Text
  imageUrl  String?
  category  String?
  status    String   @default("draft") // draft, published
  views     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("articles")
}

// ==================== วีดีโอ ====================
model Video {
  id          String   @id @default(cuid())
  title       String
  description String?
  youtubeId   String
  thumbnail   String?
  category    String?
  duration    String?
  views       Int      @default(0)
  likes       Int      @default(0)
  status      String   @default("active") // active, inactive
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("videos")
}

// ==================== สมาชิก ====================
model Member {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  phone         String?
  avatarUrl     String?
  gender        String?
  birthDate     DateTime?
  height        Float? // cm
  weight        Float? // kg
  goalWeight    Float? // kg
  activityLevel String? // sedentary, light, moderate, active, very_active
  dailyCalories Int?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("members")
}

// ==================== พนักงาน ====================
model Staff {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  avatarUrl String?
  roleId    String
  role      Role     @relation(fields: [roleId], references: [id])
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("staff")
}

// ==================== สิทธิ์ ====================
model Role {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  permissions Json     @default("[]")
  staff       Staff[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("roles")
}
